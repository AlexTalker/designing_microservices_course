services:
  - docker

before_install:
  - docker-compose -f docker-compose-storage.yml up -d
  - docker-compose -f docker-compose-storage.yml run --rm api-deployer bash -c 'while ! /setup.sh | grep successfully; do echo "Still waiting..."; sleep 1; done'

script:
  - docker-compose -f docker-compose.yml -f docker-compose-services.yml pull
  - docker-compose -f docker-compose-storage.yml run --rm api-deployer /api-deployer.sh
  - docker-compose -f docker-compose.yml -f docker-compose-services.yml build